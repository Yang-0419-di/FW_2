{% extends "layout.html" %}
{% block content %}

<!-- ğŸ”¹ å°è¦½æŒ‰éˆ• -->
<div style="margin-bottom:10px;">
    <a href="{{ url_for('billing.index') }}"><button class="button-1">TGå®¢æˆ¶ç³»çµ±</button></a>
    <a href="{{ url_for('billing.mfp_summary') }}"><button class="button-1">å®¢æˆ¶ç¸½è¡¨</button></a>
    <a href="{{ url_for('billing.person_page', sheet='æ¹¯å®¶ç‘‹') }}"><button>æ¹¯å®¶ç‘‹</button></a>
    <a href="{{ url_for('billing.person_page', sheet='å³å®—é´»') }}"><button>å³å®—é´»</button></a>
    <a href="{{ url_for('billing.person_page', sheet='åŠ‰æŸå‡') }}"><button>åŠ‰æŸå‡</button></a>
    <button type="button" onclick="history.back()">â† è¿”å›ä¸Šä¸€é </button>
    <a href="/"><button class="button-3">å›é¦–é </button></a>
</div>

<h2 style="text-align:center; margin-top:20px;">
    {{ page_name }} â€” å®¢æˆ¶è³‡æ–™åˆ†æ
</h2>

<!-- ç¬¬ä¸€å€å¡Š -->
<h3>å®¢æˆ¶æ•¸é‡</h3>
<div class="table-container-NO">
    {{ table1 | safe }}
</div>

<!-- ç¬¬äºŒå€å¡Š -->
<h3>ä¿é¤Šé€±æœŸ</h3>
<div class="table-container-NO">
    {{ table2 | safe }}
</div>

<!-- ç¬¬ä¸‰å€å¡Š -->
<h3>è·‘å‹¤æª¢æ ¸</h3>

<table class="table table-bordered">
    <thead>
        <tr>
            {% for col in df3.columns %}
                <th>{{ col }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for _, row in df3.iterrows() %}
        <tr>
            {% for col in df3.columns %}
                {% if col == "å‚™è¨»" %}
                    <td>
                        <input type="text"
                               value="{{ row[col] }}"
                               data-device="{{ row['è¨­å‚™ä»£è™Ÿ'] }}"
                               data-field="remark"
                               class="gs-input"
                               style="width:100%;">
                    </td>

                {% elif col == "æŠ„è¡¨æ–¹å¼" %}
                    <td>
                        <input type="text"
                               value="{{ row[col] }}"
                               data-device="{{ row['è¨­å‚™ä»£è™Ÿ'] }}"
                               data-field="method"
                               class="gs-input"
                               style="width:100%;">
                    </td>

                {% else %}
                    <td>{{ row[col] }}</td>
                {% endif %}
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- ğŸ”¹ è‡ªå‹•å„²å­˜ JS -->
<script>
document.querySelectorAll('.gs-input').forEach(el => {
    el.addEventListener('change', () => {
        fetch('{{ url_for("billing.save_person_field") }}', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                sheet: "{{ page_name }}",
                device_id: el.dataset.device,
                field: el.dataset.field,
                value: el.value
            })
        });
    });
});
</script>

{% endblock %}
