{% extends "layout.html" %}

{% block content %}
<!-- === 部門排程頁 calendar.html === -->

    <h2>部門排程</h2>

  <!-- FullCalendar CSS & JS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>

  <style>
    /* 允許事件標題/時間換行，移除省略號 */
    .fc .fc-event-title,
    .fc .fc-event-time,
    .fc .fc-event-main {
      white-space: normal !important;
      overflow: visible !important;
      text-overflow: clip !important;
    }

    /* 月曆 (dayGrid) 兩種事件外觀都一併處理 */
    .fc .fc-daygrid-event,
    .fc .fc-daygrid-dot-event {
      white-space: normal !important;
    }

    /* 長字串也能自動換行 */
    .fc .fc-daygrid-event .fc-event-title,
    .fc .fc-daygrid-dot-event .fc-event-title,
    .fc .fc-timegrid-event .fc-event-title {
      overflow-wrap: anywhere;
      word-break: break-word;
    }

    /* 讓事件方塊更緊湊好閱讀 */
    .fc .fc-daygrid-event {
      display: block;
      padding: 2px 4px;
    }

    /* 固定每日格子高度 */
    .fc .fc-daygrid-day-frame {
      height: 160px !important;
      overflow-y: auto !important;
    }

    /* 避免 flex 撐高 */
    .fc .fc-daygrid-day {
      flex: 0 0 auto !important;
    }

    #calendar {
      background-color: white;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 8px;
    }

    #backToTop {
      position: fixed;
      bottom: 230px;
      right: 30px;
      z-index: 1000;
      display: none;
      padding: 10px 15px;
      font-size: 16px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    #backToTop:hover {
      background-color: #0056b3;
    }
  </style>

  <div id="calendar"></div>
  <button id="backToTop" onclick="window.scrollTo({ top: 0, behavior: 'smooth' });">回頂部</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  let calendarEl = document.getElementById('calendar');

  let calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    weekends: false,
    hiddenDays: [0, 6],
    events: {
      url: '/calendar/events',
      method: 'GET'
    },
    eventDisplay: 'block',
    dayCellContent: function(arg) { return arg.dayNumberText; },
    height: 'auto',
    contentHeight: 'auto',
    dayMaxEventRows: false,
    aspectRatio: 1.35
  });

  calendar.render();
});
</script>

{% endblock %}
