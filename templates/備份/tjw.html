{% extends "layout.html" %}
{% block content %}

<!-- ğŸ”¹ å°è¦½æŒ‰éˆ• -->
<div style="margin-bottom:10px;">
    <a href="{{ url_for('billing.index') }}"><button class="button-1">TGå®¢æˆ¶ç³»çµ±</button></a>
    <a href="{{ url_for('billing.mfp_summary') }}"><button class="button-1">å®¢æˆ¶ç¸½è¡¨</button></a>
    <a href="{{ url_for('billing.person_page', sheet='æ¹¯å®¶ç‘‹') }}"><button>æ¹¯å®¶ç‘‹</button></a>
    <a href="{{ url_for('billing.person_page', sheet='å³å®—é´»') }}"><button>å³å®—é´»</button></a>
    <a href="{{ url_for('billing.person_page', sheet='åŠ‰æŸå‡') }}"><button>åŠ‰æŸå‡</button></a>
    <button type="button" onclick="history.back()">â† è¿”å›ä¸Šä¸€é </button>
    <a href="/"><button class="button-3">å›é¦–é </button></a>
</div>

<h2 style="text-align:center; margin-top:20px;">
    {{ page_name }} â€” å€‹äººå®¢æˆ¶è³‡æ–™
</h2>

<!-- ===== ç¬¬ä¸€å€å¡Š Accordionï¼ˆå®¢æˆ¶æ•¸é‡ï¼‰ ===== -->
<button class="accordion-button">å®¢æˆ¶æ•¸é‡</button>
<div class="accordion-content">
    <div class="table-container-NO">
        {{ table1 | safe }}
    </div>
</div>

<!-- ===== ç¬¬äºŒå€å¡Š Accordionï¼ˆä¿é¤Šé€±æœŸï¼‰ ===== -->
<button class="accordion-button">ä¿é¤Šé€±æœŸ</button>
<div class="accordion-content">
    <div class="table-container-NO">
        {{ table2 | safe }}
    </div>
</div>

<!-- ç¬¬ä¸‰å€å¡Šï¼ˆå®¢æˆ¶è³‡è¨Šè¡¨æ ¼ï¼‰ -->
<h3>å®¢æˆ¶è³‡è¨Š</h3>

<!-- æœå°‹åŠŸèƒ½ -->
<input
    type="text"
    id="tableSearch"
    placeholder="ğŸ” å³æ™‚æœå°‹ï¼ˆå®¢æˆ¶åç¨± / è¨­å‚™ä»£è™Ÿ / å‚™è¨» / æŠ„è¡¨æ–¹å¼ï¼‰"
    style="
        width: 100%;
        max-width: 420px;
        padding: 6px 10px;
        margin-bottom: 10px;
        font-size: 16px;
    ">

<table class="table table-bordered">
    <thead>
        <tr>
            {% for col in df3.columns %}
                <th>{{ col }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for _, row in df3.iterrows() %}
        <tr>
            {% for col in df3.columns %}
                {% if col == "è¨­å‚™ä»£è™Ÿ" %}
                    <td>
                        <a href="{{ url_for('billing.index') }}?device_id={{ row[col] }}" style="color: blue; text-decoration: none;">
                            {{ row[col] }}
                        </a>
                    </td>
                {% elif col == "å‚™è¨»" %}
                    <td>
                        <input type="text"
                               value="{{ row[col] }}"
                               data-device="{{ row['è¨­å‚™ä»£è™Ÿ'] }}"
                               data-field="remark"
                               class="gs-input"
                               style="width:100%;">
                    </td>
                {% elif col == "æŠ„è¡¨æ–¹å¼" %}
                    <td>
                        <input type="text"
                               value="{{ row[col] }}"
                               data-device="{{ row['è¨­å‚™ä»£è™Ÿ'] }}"
                               data-field="method"
                               class="gs-input"
                               style="width:100%;">
                    </td>
                {% else %}
                    {% if col == "å®¢æˆ¶åç¨±" %}
                        <td style="text-align:left;">{{ row[col] }}</td>
                    {% else %}
                        <td>{{ row[col] }}</td>
                    {% endif %}
                {% endif %}
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- ğŸ”¹ è‡ªå‹•å„²å­˜ JS -->
<script>
document.querySelectorAll('.gs-input').forEach(el => {
    el.addEventListener('change', () => {
        fetch('{{ url_for("billing.save_person_field") }}', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                sheet: "{{ page_name }}",
                device_id: el.dataset.device,
                field: el.dataset.field,
                value: el.value
            })
        });
    });
});

// Accordion å±•é–‹/æ”¶åˆ JS
document.querySelectorAll('.accordion-button').forEach(btn => {
    btn.addEventListener('click', () => {
        const content = btn.nextElementSibling;

        // æ”¶èµ·å…¶ä»–å…§å®¹
        document.querySelectorAll('.accordion-content').forEach(c => {
            if (c !== content) c.classList.remove('show');
        });

        // åˆ‡æ›ç›®å‰å…§å®¹
        content.classList.toggle('show');
    });
});

// ğŸ” å³æ™‚æœå°‹ï¼ˆåªå½±éŸ¿å®¢æˆ¶è³‡è¨Šè¡¨æ ¼ï¼‰
document.getElementById('tableSearch').addEventListener('keyup', function () {
    const keyword = this.value.toLowerCase();
    const rows = document.querySelectorAll('table tbody tr');

    rows.forEach(row => {
        let text = row.innerText.toLowerCase();
        row.style.display = text.includes(keyword) ? '' : 'none';
    });
});
</script>

<!-- Accordion CSS -->
<style>
.accordion-button {
    padding: 6px 14px;
    font-size: 18px;
    font-weight: normal;
    border: 2px solid #00AEAE;
    background-color: transparent;
    color: #00AEAE;
    border-radius: 6px;
    cursor: pointer;
    text-align: left;
    transition: all 0.2s ease;
    margin-top: 10px;
}

.accordion-button:hover {
    background: linear-gradient(135deg, #00AEAE, #3BC6C6);
    color: white;
}

.accordion-content {
    display: none;           /* é è¨­æ”¶èµ· */
    flex-direction: column;
    gap: 5px;
    padding: 10px 0;
}

.accordion-content.show {
    display: flex;
}
</style>

{% endblock %}
